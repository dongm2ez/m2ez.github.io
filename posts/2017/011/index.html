<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>互联网的基础协议 HTTP - 麦索的麦田</title><meta name="Description" content="麦索的个人博客"><meta property="og:title" content="互联网的基础协议 HTTP" />
<meta property="og:description" content="HTTP 协议中文全称 「超文本传输协议」，是互联网的基础协议，目前最新版本为 HTTP 2.0。 HTTP 是基于 TCP/IP 协议的 应用层协议，主要规定了客户端与服务器端之间通信" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.m2ez.com/posts/2017/011/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-07-09T16:59:37+08:00" />
<meta property="article:modified_time" content="2017-07-09T16:59:37+08:00" /><meta property="og:site_name" content="麦索的麦田" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="互联网的基础协议 HTTP"/>
<meta name="twitter:description" content="HTTP 协议中文全称 「超文本传输协议」，是互联网的基础协议，目前最新版本为 HTTP 2.0。 HTTP 是基于 TCP/IP 协议的 应用层协议，主要规定了客户端与服务器端之间通信"/>
<meta name="application-name" content="麦索的麦田">
<meta name="apple-mobile-web-app-title" content="麦索的麦田"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://blog.m2ez.com/posts/2017/011/" /><link rel="prev" href="https://blog.m2ez.com/posts/2017/012/" /><link rel="next" href="https://blog.m2ez.com/posts/2017/010/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "互联网的基础协议 HTTP",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/blog.m2ez.com\/posts\/2017\/011\/"
        },"genre": "posts","keywords": "HTTP, WEB","wordcount":  3149 ,
        "url": "https:\/\/blog.m2ez.com\/posts\/2017\/011\/","datePublished": "2017-07-09T16:59:37+08:00","dateModified": "2017-07-09T16:59:37+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "麦索"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="麦索的麦田">麦索的麦田</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"><i class="fas fa-fw fa-file-alt"></i> 文章 </a><a class="menu-item" href="/categories/"><i class="fas fa-fw fa-folder"></i> 分类 </a><a class="menu-item" href="/tags/"><i class="fas fa-fw fa-tag"></i> 标签 </a><a class="menu-item" href="/about/"><i class="fas fa-fw fa-user"></i> 关于 </a><a class="menu-item" href="/about/" title="Dongm2ez"> Dongm2ez </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="麦索的麦田">麦索的麦田</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title=""><i class="fas fa-fw fa-file-alt"></i>文章</a><a class="menu-item" href="/categories/" title=""><i class="fas fa-fw fa-folder"></i>分类</a><a class="menu-item" href="/tags/" title=""><i class="fas fa-fw fa-tag"></i>标签</a><a class="menu-item" href="/about/" title=""><i class="fas fa-fw fa-user"></i>关于</a><a class="menu-item" href="/about/" title="Dongm2ez">Dongm2ez</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">互联网的基础协议 HTTP</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>麦索</a>
</span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%8A%80%E6%9C%AF/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>计算机技术</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2017-07-09">2017-07-09</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;约 3149 字&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;预计阅读 7 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#http09">HTTP/0.9</a></li>
        <li><a href="#http10">HTTP/1.0</a></li>
        <li><a href="#http11">HTTP/1.1</a></li>
        <li><a href="#http2">HTTP/2</a></li>
        <li><a href="#一次普通的-http-的生命周期">一次普通的 HTTP 的生命周期</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>HTTP 协议中文全称 「超文本传输协议」，是互联网的基础协议，目前最新版本为 HTTP 2.0。</p>
<p>HTTP 是基于 TCP/IP 协议的 应用层协议，主要规定了客户端与服务器端之间通信的格式，默认使用80端口。</p>
<p>HTTP 是无连接无状态的。</p>
<h3 id="http09">HTTP/0.9</h3>
<p>1991年发布，该版本只有一个命令 <code>GET</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">GET /index.html
</span></span></code></pre></td></tr></table>
</div>
</div><p>以上命令表示 TCP 连接建立后，客户端向服务器端请求网页 index.html。</p>
<p>协议规定，服务器只能回应 HTML 格式的字符串，不能回应其他格式的数据，当服务器发送数据完毕，TCP连接就关闭。</p>
<h3 id="http10">HTTP/1.0</h3>
<p>1996年5月发布，对0.9版进行大幅度增强。</p>
<p>在这一版本中，对发送内容限制取消，任何格式都可以发送，不仅仅是字符串，还能传输图像、视频、二进制文件等等。</p>
<p>除了 <code>GET</code> 还引入 <code>POST</code> 和 <code>HEAD</code>，丰富了客户端与服务器交互的手段。</p>
<p>HTTP请求和响应的格式也发生变化，在数据之外，每次通信都必须包含头信息（HTTP header），用来描述元数据。还增加了状态码、字符集支持、多部分发送（multi-part type）、权限认证（authorization）、缓存（cache）、内容编码（content encoding）等。</p>
<p><em>缺点</em></p>
<p>HTTP/1.0 的主要缺点是，每个 TCP 连接只能发送一个请求，发送完毕，连接就关闭，如果还要请求其他资源，就必须再次新建一个连接。</p>
<p>TCP 连接的新建是一个成本很高的过程，需要客户端与服务端进行三次握手，并且开始时发送速率较慢，这造成 HTTP/1.0 性能较差，随着网页内容越来越丰富，所要使用的外部资源越来越多，这个问题就愈发突出。</p>
<p>为了解决这个问题，有些浏览器在请求时加入了一个非标准头信息字段。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Connection: keep-alive
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个头信息字段要求服务器不要关闭 TCP 连接，以便其他请求能复用，服务器会回应这个字段，一个可复用的 TCP连接就建立了，直到客户端或服务器端主动关闭连接，但这不是标准字段，不同的实现行为可能带来不一致的行为。</p>
<h3 id="http11">HTTP/1.1</h3>
<p>1997年1月，HTTP/1.1发布，这是目前最流行的版本，它对 HTTP/1.0 协议进行了进一步的完善。</p>
<p>这一版本中持久连接成为规范，既 TCP 连接默认不关闭，可以被多个请求复用，不用客户端发送要求保持连接的头信息。当客户端和服务器端发现对方一段时间没有活动，那就可以主动关闭连接，目前对于同一个域名，大多数浏览器允许同时建立 6 个持久连接。</p>
<p>1.1 引入管道机制，在之前的版本中客户端请求两个资源，在同一个 TCP 连接里面，先发送A请求，等待服务器做出响应后再发送B请求，而管道机制允许浏览器同时发送A请求和B请求，服务器依然按照顺序回应。</p>
<p>当一个 TCP 连接可以响应多个请求是，必须有一种机制来区分数据包到底属于哪一个请求，因此加入了 Content-Length 响应头，用来声明本次响应的数据长度。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Content-Length: <span class="m">4999</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>以上头信息告诉客户端，本次响应的长度是 4999 个字节，超出部分就属于下一个请求。</p>
<p>使用 Content-Length 的前提是服务器发送响应前必须知道数据的长度。对于一些耗时操作，这意味着服务器要等到所有操作完成才能发送数据，显然这样效率不高。</p>
<p>因此 1.1 规定可以不使用 Content-Length ，而使用分块传输编码，只要请求或响应的头信息有 Transfer-Encoding 字段，就表明响应将由数量未定的数据块组成，这种方式就是产生一块数据，就发送一块，由「流模式」（stream）取代 「缓存模式」（buffer）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Transfer-Encoding：chunked
</span></span></code></pre></td></tr></table>
</div>
</div><p>当数据块发送给客户端时，会有一个 16 进制的数值，表示这个块的长度，当这个值为0时表示本次响应的数据已经发送完毕。</p>
<p>当网络速度较慢是可以明显感觉这种现象，网页信息是逐渐加载出现，而非从白屏突然到网页展现。</p>
<p>1.1 版本还新增了许多动词请求方法 <code>PUT</code>、<code>PATCH</code>、<code>HEAD</code>、<code>OPTIONS</code>、<code>DELETE</code>。</p>
<p>另外，客户端请求头新增了 Host 字段，用来指定服务器域名，有了 <code>HOST</code> 字段，就可以将请求发送到同一台服务器的不同网站，为虚拟主机的兴起打下了基础。</p>
<p><em>缺点</em></p>
<p>HTTP/1.1 虽然允许复用 TCP 连接，但是同一个 TCP 连接中，所有数据通信都是按次序进行的。服务器只有处理完一个请求后，才会进行下一个请求的处理。要是前面的请求处理特别慢，后面的请求就会一直处于排队等待状态，这称之为「队头阻塞」（Head-of-line blocking）。</p>
<p>为了避免这个问题，有两种方法来解决：</p>
<ol>
<li>减少请求数。</li>
<li>同时多开持久连接。</li>
</ol>
<p>因此出现很多网页优化技巧，如合并脚本和样式表，将图片嵌入CSS代码、雪碧图、静态资源CDN、域名分片（domain sharding）等等。</p>
<h3 id="http2">HTTP/2</h3>
<p>2009年，谷歌公开了其自行研发的 SPDY 协议，这个协议主要解决 HTTP/1.1 效率不高的问题。</p>
<p>该协议在 Chrome 浏览器上证明可行后，被当做 HTTP/2 的基础，主要特性都在 HTTP/2 中继承。谷歌在2015年9月宣布移除 SPDY 的支持，拥抱HTTP/2，并在 Chrome 51 中生效。</p>
<p>2015年，HTTP/2 发布，去掉后面的小数位是因为标准委员会不打算发布其子版本，一个版本将是 HTTP/3</p>
<p><em>二进制协议</em></p>
<p>HTTP/1.1 的头信息肯定是文本（ASCII编码），数据体可是文本也可是二进制。HTTP/2 则是一个彻底的二进制协议，头体皆为二进制，且统称为「帧」（frame）: 头信息帧与数据帧。</p>
<p>二进制协议的好处是可以定义额外的帧，HTTP/2 定义了约10种帧，为未来的高级应用打下了基础。如果使用文本实现此功能，解析数据将变得特别麻烦，二进制解析会方便得多。</p>
<p><em>多工</em></p>
<p>HTTP/2 将 TCP 连接复用，在一个连接里，客户端和浏览器都可以同时发送多个请求或者响应，而且不用按照顺序进行，这样就避免了「队头阻塞」。接上例，依然有A和B两个请求，服务器同时收到两个请求，先处理A请求，但发现处理过程非常耗时，于是将请求A已经处理的部分响应给客户端，接着处理B请求，完成B请求的响应后再处理A请求剩余部分。</p>
<p>这种方式叫做多工（Multiplexing）。是双向的，实时通信处理信息方式。</p>
<p><em>数据流</em></p>
<p>HTTP/2 的数据包不是按序发送，同一个连接中连续的数据包，可能分属不同请求，所以必须对数据包进行标记，以指出其属于哪个请求。</p>
<p>HTTP/2 将每个请求或响应的数据包称为一个数据流（stream）。 每个流都有其独一无二的编号ID，用于区分它的从属。另外还规定客户端发送的数据流，编号ID全部为奇数，服务器端的全部为偶数。</p>
<p>数据流在发送过程中，客户端和服务器端都可以发送信号（RST_STREAM帧），取消这个数据流。HTTP/1.1 取消数据流的唯一方法是关闭 TCP 连接，这就是说，HTTP/2 可以取消请求同时保证 TCP 连接存活，以使 TCP 连接可以被其他请求使用。</p>
<p>客户端还可指定数据流的优先级，越高优先级，服务器会越早回应。</p>
<p><em>头信息压缩</em></p>
<p>HTTP 协议是无状态的，每次请求都需要附加上所有信息。因此对于同一个网站的许多请求附加信息都是重复的，如 <code>Cookie</code> 和 <code>User Agent</code>，这样浪费很多带宽同时也影响速度。</p>
<p>HTTP/2 对此进行了优化，引入了头信息压缩机制（header compression）。一方面，头信息使用 <code>gzip</code> 或 <code>compress</code> 压缩后再发送。客户端和服务器端同时维护着一张头信息表，所有字段都会存入这个表，生成一个索引号，以后就不发送同样字段了，只发送索引号，这样就提高了速度。</p>
<p><em>服务器推送</em></p>
<p>HTTP/2 允许服务器未接到请求就主动向客户端发送资源，称为服务器推送（server push）</p>
<p>常见场景是客户端请求一个网页，网页中包含很多静态资源，正常请求，客户端收到网页后解析 HTML 发现静态资源，再发出静态资源请求。</p>
<p>此时，服务器其实可以预期到客户端要请求静态资源，所以可以把资源随同网页主动推送给客户端。</p>
<blockquote>
<p>截至 2015 年末，主要的浏览器的最新版本已经支持 HTTP/2 这一协议。其中：
Google Chrome、Mozilla Firefox、Microsoft Edge 和 Opera 已支持 HTTP/2，并默认启用。
Internet Explorer 自 IE 11 开始支持 HTTP/2，并预设激活。</p>
</blockquote>
<h3 id="一次普通的-http-的生命周期">一次普通的 HTTP 的生命周期</h3>
<ol>
<li>客户端先向 DNS 服务器请求获取域名指向的真实 IP 地址。</li>
<li>获取到真实 IP 地址后向对应的服务器请求建立 TCP/IP 连接。</li>
<li>发送 HTTP 协议请求包给服务器。</li>
<li>服务器接收到请求包后调用自身服务进行处理。</li>
<li>服务器返回 HTTP Response （响应）。</li>
<li>客户端收到响应后解析渲染</li>
<li>客户端确认收到所有内容后断开连接。</li>
</ol>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2017-07-09</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://blog.m2ez.com/posts/2017/011/" data-title="互联网的基础协议 HTTP" data-hashtags="HTTP,WEB"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://blog.m2ez.com/posts/2017/011/" data-hashtag="HTTP"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Hacker News" data-sharer="hackernews" data-url="https://blog.m2ez.com/posts/2017/011/" data-title="互联网的基础协议 HTTP"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://blog.m2ez.com/posts/2017/011/" data-title="互联网的基础协议 HTTP"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@6.20.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://blog.m2ez.com/posts/2017/011/" data-title="互联网的基础协议 HTTP"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/http/">HTTP</a>,&nbsp;<a href="/tags/web/">WEB</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/2017/012/" class="prev" rel="prev" title="趣说什么是 依赖注入 和 控制反转"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>趣说什么是 依赖注入 和 控制反转</a>
            <a href="/posts/2017/010/" class="next" rel="next" title="HTTP 协议 Request 和 Response 参数笔记">HTTP 协议 Request 和 Response 参数笔记<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.112.3">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2014 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">麦索</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br"/>
                    <span class="icp"><a href="https://beian.miit.gov.cn/" target="_blank" rel="external nofollow">京ICP备15012847号-1</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.1/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":50},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>

<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title> PHP是什么-PHP的架构及原理概述 </title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1> 麦索的麦田 </h1>
        <h2>Nothing is impossible</h2>
        <a href="/" class="button"><small>go back</small>Index</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          
          <h2>PHP是什么-PHP的架构及原理概述</h2>
<p class="meta">2018-02-25</p>

<p>记得我刚开始学习PHP的时候，许多面试官会经常问我PHP是什么，那时的标准回答是PHP是一种弱类型动态脚本编程语言，开源，免费，是超文本预处理器的缩写。</p>

<p>这只是很浅的解释，PHP对我来说是一个工具，是我手里的一把锤子，虽然这把锤子时常被调侃为两边都是起钉器的锤子。</p>

<p><img src="http://img.m2ez.com/15195409815276.jpg" alt="" /></p>

<h2 id="php-的特点">PHP 的特点</h2>

<p><strong>多进程模型</strong></p>

<p>PHP是以多进程模型设计的，这样的好处是请求之间互不干涉，一个请求失败也不会对其他进程造成影响，作为最开始仅仅用于个人网站的一个工具集这样的设计并没有什么不妥，随着PHP的应用变大，访问量增加这种方式显然是不合适的，因为启动一个进程的开销对于海量请求是不划算的，所以现在PHP基本都是运行在PHP-FPM的管理下的，这是一个PHP进程管理器，它常驻内存启动一些PHP进程待命，当请求进入时分配一个进程进行处理，PHP进程处理完毕后回收进程，但并不销毁进程，这让PHP也能应对高流量的访问请求。</p>

<p>当然现在也有PHP多线程的解决方案和基于协程的解决方案让PHP更高效的处理WEB请求。</p>

<p><strong>弱类型</strong></p>

<p>与 JAVA、C/C++ 不同，PHP是一门若类型的语言，变量在声明的那一刻是不需要确定它的类型的，而在运行时类型也会发生显式或隐式的类型改变，这也是PHP开发应用迅速、方便的原因之一。</p>

<p><strong>其他</strong></p>

<p>Zend 引擎 + Ext 扩展 的模式降低了内部耦合，可以方便的为PHP本身增加功能和去除功能。</p>

<p>语法简单，没有太多强制规范，编程风格上既可以用过程式、也可以用面向对象的方式进行开发，当然函数式也可以。</p>

<h2 id="php-的架构">PHP 的架构</h2>

<p><img src="http://img.m2ez.com/15195422629760.jpg" alt="" /></p>

<p>以目前的 PHP 主流版本 PHP7 和 PHP5 来说架构是如上图所示，主要有四层体系构成，从下到上依次是 Zend 引擎、Extensions 扩展、SAPI 接口、上层应用。</p>

<p><strong>Zend 引擎</strong></p>

<p>Zend 引擎是 PHP4 以后加入 PHP 的，是对原有PHP解释器的重写，整体使用 C 语言进行开发，也就是说可以把PHP理解成用C写的一个编程语言软件，引擎的作用是将PHP代码翻译为一种叫opcode的中间语言，它类似于JAVA的ByteCode（字节码）。</p>

<p>引擎对PHP代码会执行四个步骤：</p>

<ol>
  <li>词法分析 Scanning（Lexing），将 PHP 代码转换为语言片段（Tokens）。</li>
  <li>解析 Parsing， 将 Tokens 转换成简单而有意义的表达式。</li>
  <li>编译 Compilation，将表达式编译成Opcode。</li>
  <li>执行 Execution，顺序执行Opcode，每次一条，以实现PHP代码所表达的功能。</li>
</ol>

<p>APC、Opchche 这些扩展可以将Opcode缓存以加速PHP应用的运行速度，使用它们就可以在请求再次来临时省略前三步。</p>

<p>引擎也实现了基本的数据结构、内存分配及管理，提供了相应的API方法供外部调用。</p>

<p><strong>Extensions 扩展</strong></p>

<p>常见的内置函数、标准库都是通过extension来实现的，这些叫做PHP的核心扩展，用户也可以根据自己的要求安装PHP的扩展。</p>

<p><strong>SAPI</strong></p>

<p>SAPI 是 Server Application Programming Interface 的缩写，中文为服务端应用编程接口，它通过一系列钩子函数使得PHP可以和外围交换数据，SAPI 就是 PHP 和外部环境的代理器，它把外部环境抽象后，为内部的PHP提供一套固定的，统一的接口，使得 PHP 自身实现能够不受错综复杂的外部环境影响，保持一定的独立性。</p>

<p>通过 SAPI 的解耦，PHP 可以不再考虑如何针对不同应用进行兼容，而应用本身也可以针对自己的特点实现不同的处理方式。</p>

<p><strong>上层应用</strong></p>

<p>程序员编写的PHP程序，无论是 Web 应用还是 Cli 方式运行的应用都是上层应用，PHP 程序员主要工作就是编写它们。</p>

<h2 id="总结">总结</h2>

<p>这些东西如果你学习过 android 开发理解起来显然更容易，因为android的架构和PHP的这种架构看起来很相似。当你理解这些后你就会理解为什么PHP的创始人会说PHP开发其实是不需要框架的，因为PHP的设计本身就是一个类似框架的东西，如果用汽车比喻的话PHP本身就是就是车的骨架，Zend的是引擎，Ext是轮子，方向盘等车的组件，SAPI 就是路。</p>

<p>对于这些内容，可能有的人觉得有点无用，因为很多人偏执的认为自己只是个开车的，为什么开车的要了解车子是怎么跑起来的，对于了解如何制造一辆车更是嗤之以鼻。我曾经也这样认为，直到翻译Laravel文档时，Laravel 的作者给了我一些启发，也把这些话送给看到这个文章的你们：</p>

<blockquote>
  <p>使用「现实世界」中的任何工具时，如果理解这个工具的运作原理，那么你会更加得心应手的使用这个工具。应用开发也是这样。当你明白你的开发工具如何运行的，你就会对它们的使用游刃有余。</p>
</blockquote>

<blockquote>
  <p>这篇文档的目的是让你更好的理解 Laravel 框架如何进行工作及它的工作原理。通过对框架进行全面的了解，一切都不会那么「神奇」，也将会让你更有自信的构建你的应用。</p>
</blockquote>



<!--PC和WAP自适应版-->
<div id="SOHUCS" sid="PHP是什么-PHP的架构及原理概述" ></div>
<script type="text/javascript">
(function(){
var appid = 'cyt8K3bay';
var conf = 'prod_4cce8456a31ddba41cd9cd6ae71a8ee7';
var width = window.innerWidth || document.documentElement.clientWidth;
if (width < 960) {
window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="http://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("http://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>


        </section>

        <aside id="sidebar">
          <!--<a href="https://github.com/pietromenna/jekyll-architect-theme/archive/master.zip" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/pietromenna/jekyll-architect-theme/archive/master.tar.gz" class="button">
            <small>Download</small>
            .tar.gz file
          </a>-->

          <p class="repo-owner"><a href="https://github.com/jasonlong/architect-theme">architect-theme</a> is maintained by <a href="https://github.com/jasonlong">jasonlong</a>.</p>

          <p class="repo-owner"><a href="https://github.com/pietromenna/jekyll-architect-theme">jekyll-architect-theme</a> is maintained by <a href="https://github.com/pietromenna">pietromenna</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</p>
        </aside>
      </div>
    </div>

  </body>
</html>

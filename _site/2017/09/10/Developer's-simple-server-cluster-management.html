<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title> 开发者的简单服务器集群管理 </title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1> 麦索的麦田 </h1>
        <h2>Nothing is impossible</h2>
        <a href="/" class="button"><small>go back</small>Index</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          
          <h2>开发者的简单服务器集群管理</h2>
<p class="meta">2017-09-10</p>

<h2 id="概述">概述</h2>

<p>本篇是以开发者的视角进行，非专业运维视角，开发管理服务器集群，也许仅仅是自己的项目，或者是在创业公司而没有专业的运维。</p>

<p>开发管理服务器集群，用各种工具需要付出一定的学习成本，但开发者的主要工作不在于此，所以我们需要最简单又比较安全的管理方法，以下是一个对开发者比较好的管理服务器方案，希望对大家有帮助</p>

<h2 id="实现方法">实现方法</h2>

<p>现有服务器 A、B、C 三台服务器，我们将 A 作为部署维护服务器，连接 B、C 进行操作。</p>

<p>首先更改服务器名 <code class="highlighter-rouge">sudo vim /etc/hostname</code>，以使得每个服务器有易于你标识的名字，让我们操作服务器时根据提示符知道我们现在操作哪一台服务器。</p>

<p>查看系统网络信息 <code class="highlighter-rouge">ifconfig</code>，这一步是获取服务器的 IP 地址。</p>

<p>我使用的服务器是 Ubuntu，Ubuntu 更新 <code class="highlighter-rouge">sudo apt update</code>，16.04 以上版本可使用 <code class="highlighter-rouge">apt</code> 代替 <code class="highlighter-rouge">apt-get</code>。</p>

<p>安装 SSH 服务 <code class="highlighter-rouge">sudo apt install ssh</code>。</p>

<p>禁用防火墙，不禁用无法连接用 SSH 连接服务器，禁用命令 <code class="highlighter-rouge">sudo ufw disable</code>，当然更安全的做法是只允许特定端口可访问，这里为了简单直接禁用了防火墙。</p>

<p>SSH 连接命令 <code class="highlighter-rouge">ssh -p 端口号 username@xxx.xxx.xxx.xxx</code>，端口非必须，默认22。</p>

<p>默认 SSH 使用密码进行连接，更安全的方式是使用密钥进行连接，在 of 上使用 <code class="highlighter-rouge">ssh-keygen</code> 创建密钥，会在家目录的 .ssh 目录中生成 id_rsa 和 id_rsa.pub 这两个私钥和公钥。将公钥上传到 B 和 C 中，可以使用 scp 命令或者 ssh-copy-id 命令。</p>

<p>踩坑：配置ssh免密码登录后，仍提示输入密码</p>

<p>SSH 不希望 <code class="highlighter-rouge">home</code> 目录和 <code class="highlighter-rouge">~/.ssh</code> 目录对组有写权限，进行以下修改:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chmod g-w /home/dongm2ez 
chmod 700 /home/dongm2ez/.ssh
chmod 600 /home/dongm2ez/.ssh/authorized_keys
</code></pre></div></div>

<p>在 B 和 C 的家目录创建 .ssh 目录，使用 <code class="highlighter-rouge">cat path/to/id_rsa.pub &gt;&gt; authorized_keys</code> 将秘钥内容加入到认证文件中。同时给予其权限 <code class="highlighter-rouge">chmod 600 authorized_keys</code></p>

<p>在 of 的 <code class="highlighter-rouge">~/.ssh/config</code> 文件中可以配置 ssh 连接信息。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Host B
HostName xxx.xxx.xxx.xxx
User 用户名
Port 端口号

Host C
HostName xxx.xxx.xxx.xxx
User 用户名
Port 端口号

...
</code></pre></div></div>

<p>这样就可以使用 <code class="highlighter-rouge">ssh hostname</code> 进行主机连接了，每新加一台管理服务器只需更新这个文件就可。</p>

<p>同时为了安全应该禁用 root 用户登录 和 密码登录，使用 <code class="highlighter-rouge">sudo vim /etc/ssh/sshd_config</code> 编辑文件，进行以下修改。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RSAAuthentication yes #开启RSA验证
PubkeyAuthentication yes #是否使用公钥验证
PasswordAuthentication no #禁止使用密码验证登录
PermitRootLogin no #禁止root用户登录
</code></pre></div></div>

<h2 id="总结">总结</h2>

<p>这样的服务器管理方法对于管理几台或十几台服务器是对开发者比较好的，简单也安全。</p>

<p>对于更多的服务器管理，我们就需要工具和自动化脚本了。</p>

<p>现代开发者，请学会如何使用 docker ，不仅仅是开发会让你很方便，而且能使得你的开发环境和线上测试和生产环境完全一致，只要他们是用同一个 dockerfile 文件构建的镜像。</p>



<!--PC和WAP自适应版-->
<div id="SOHUCS" sid="开发者的简单服务器集群管理" ></div>
<script type="text/javascript">
(function(){
var appid = 'cyt8K3bay';
var conf = 'prod_4cce8456a31ddba41cd9cd6ae71a8ee7';
var width = window.innerWidth || document.documentElement.clientWidth;
if (width < 960) {
window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="http://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("http://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>


        </section>

        <aside id="sidebar">
          <!--<a href="https://github.com/pietromenna/jekyll-architect-theme/archive/master.zip" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/pietromenna/jekyll-architect-theme/archive/master.tar.gz" class="button">
            <small>Download</small>
            .tar.gz file
          </a>-->

          <p class="repo-owner"><a href="https://github.com/jasonlong/architect-theme">architect-theme</a> is maintained by <a href="https://github.com/jasonlong">jasonlong</a>.</p>

          <p class="repo-owner"><a href="https://github.com/pietromenna/jekyll-architect-theme">jekyll-architect-theme</a> is maintained by <a href="https://github.com/pietromenna">pietromenna</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</p>
        </aside>
      </div>
    </div>

  </body>
</html>
